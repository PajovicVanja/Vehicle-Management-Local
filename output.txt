Output generated at: 2025-10-04T09:57:50.237Z
Project root: C:\aaFERI\PREDMETI\3. Semestar\VUI\App\RIRSsolo

====================
DUMP FROM DIRECTORIES
====================

=== FILE START ===
Path: api\auth\profile.js
--- CONTENT START ---
// api/auth/profile.js
const { db } = require('../_lib/firebaseAdmin');
const { verifyAuth } = require('../_lib/verifyAuth');

module.exports = async (req, res) => {
  if (req.method !== 'GET') return res.status(405).json({ message: 'Method not allowed' });

  const user = await verifyAuth(req, res);
  if (!user) return;

  try {
    const userDoc = await db.collection('users').doc(user.uid).get();
    if (!userDoc.exists) return res.status(404).json({ message: 'User document not found' });

    const data = userDoc.data();
    res.status(200).json({
      email: data.email,
      role: data.role || 'Driver',
      licenseImageUrl: data.licenseImageUrl || null
    });
  } catch (e) {
    console.error('profile error:', e);
    res.status(500).json({ message: 'Error fetching profile', error: e.message });
  }
};
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: api\auth\upload-license.js
--- CONTENT START ---
// api/auth/upload-license.js
const formidable = require('formidable');
const cloudinary = require('../_lib/cloudinary');
const { db } = require('../_lib/firebaseAdmin');
const { verifyAuth } = require('../_lib/verifyAuth');

module.exports = async (req, res) => {
  if (req.method !== 'POST') return res.status(405).json({ message: 'Method not allowed' });

  const user = await verifyAuth(req, res);
  if (!user) return;

  try {
    const form = formidable({ multiples: false, keepExtensions: true });
    const { fields, files } = await new Promise((resolve, reject) => {
      form.parse(req, (err, fields, files) => (err ? reject(err) : resolve({ fields, files })));
    });

    const file = files.licenseImage;
    if (!file) return res.status(400).json({ message: 'No file uploaded' });

    const upload = await cloudinary.uploader.upload(file.filepath, {
      folder: `licenses/${user.uid}`
    });

    const imageUrl = upload.secure_url;

    const ref = db.collection('users').doc(user.uid);
    const snap = await ref.get();
    if (!snap.exists) return res.status(404).json({ message: 'User document not found' });

    await ref.update({ licenseImageUrl: imageUrl });
    res.status(200).json({ message: 'License image uploaded successfully', imageUrl });
  } catch (e) {
    console.error('upload-license error:', e);
    res.status(500).json({ message: 'Image upload failed', error: e.message });
  }
};
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: api\health.js
--- CONTENT START ---
// api/health.js
module.exports = (req, res) => {
  res.status(200).json({ status: 'ok', message: 'API is running', timestamp: new Date().toISOString() });
};
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: api\reservation\reservation\[resId].js
--- CONTENT START ---
// api/reservation/reservation/[resId].js
const { db } = require('../../_lib/firebaseAdmin');
const { verifyAuth } = require('../../_lib/verifyAuth');

module.exports = async (req, res) => {
  const { resId } = req.query;
  const method = req.method;

  const user = await verifyAuth(req, res);
  if (!user) return;

  try {
    if (method === 'GET') {
      const ref = db.collection('reservation').doc(resId);
      const doc = await ref.get();
      if (!doc.exists) return res.status(404).json({ message: 'Reservation not found' });
      return res.status(200).json({ id: doc.id, ...doc.data() });
    }

    if (method === 'DELETE') {
      const snap = await db.collection('reservation').where('reservationId', '==', resId).get();
      if (snap.empty) return res.status(404).json({ message: 'No reservation found with the specified ID' });
      const batch = db.batch();
      snap.forEach(d => batch.delete(d.ref));
      await batch.commit();
      return res.status(200).json({ message: `Reservation with id '${resId}' successfully deleted` });
    }

    return res.status(405).json({ message: 'Method not allowed' });
  } catch (e) {
    console.error('reservation [id] error:', e);
    res.status(500).json({ message: 'Error handling reservation', error: e.message });
  }
};
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: api\reservation\reservation.js
--- CONTENT START ---
// api/reservation/reservation.js
const { db } = require('../_lib/firebaseAdmin');
const { verifyAuth } = require('../_lib/verifyAuth');

module.exports = async (req, res) => {
  if (req.method !== 'GET') return res.status(405).json({ message: 'Method not allowed' });

  const user = await verifyAuth(req, res);
  if (!user) return;

  try {
    const snap = await db.collection('reservation').get();
    const list = snap.docs.map(d => d.data());
    res.status(200).json(list);
  } catch (e) {
    console.error('get reservations error:', e);
    res.status(500).json({ message: 'Error fetching reservations', error: e.message });
  }
};
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: api\vehicle\admin-reservations.js
--- CONTENT START ---
// api/vehicle/admin-reservations.js
const { db } = require('../_lib/firebaseAdmin');
const { verifyAuth } = require('../_lib/verifyAuth');

module.exports = async (req, res) => {
  if (req.method !== 'GET') return res.status(405).json({ message: 'Method not allowed' });

  const user = await verifyAuth(req, res);
  if (!user) return;
  if (user.role !== 'Admin') return res.status(403).json({ message: 'Unauthorized access. Only admins can view reservations.' });

  try {
    const snap = await db.collection('reservation').get();
    const out = [];
    for (const doc of snap.docs) {
      const r = doc.data();
      let vehicle = null;
      if (r.vehicleId) {
        const v = await db.collection('vehicles').doc(r.vehicleId).get();
        vehicle = v.exists ? v.data() : null;
      }
      let userData = null;
      if (r.userId) {
        const u = await db.collection('users').doc(r.userId).get();
        userData = u.exists ? u.data() : null;
      }
      out.push({
        reservationId: r.reservationId,
        startDate: r.startDate,
        endDate: r.endDate,
        status: r.status,
        user: userData ? { email: userData.email || 'N/A', licenseImageUrl: userData.licenseImageUrl || null } : { email: 'N/A', licenseImageUrl: null },
        vehicle: vehicle ? { vehicleName: vehicle.vehicleName || 'N/A', color: vehicle.color || 'N/A', engine: vehicle.engine || 'N/A' } : { vehicleName: 'N/A', color: 'N/A', engine: 'N/A' }
      });
    }
    res.status(200).json({ success: true, data: out });
  } catch (e) {
    console.error('admin-reservations error:', e);
    res.status(500).json({ success: false, message: 'Error fetching reservations.', error: e.message });
  }
};
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: api\vehicle\malfunctions.js
--- CONTENT START ---
// api/vehicle/malfunctions.js
const { db } = require('../_lib/firebaseAdmin');
const { verifyAuth } = require('../_lib/verifyAuth');

module.exports = async (req, res) => {
  if (req.method !== 'GET') return res.status(405).json({ message: 'Method not allowed' });

  const user = await verifyAuth(req, res);
  if (!user) return;

  try {
    const snap = await db.collection('malfunctions').get();
    const list = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    res.status(200).json(list);
  } catch (e) {
    console.error('get malfunctions error:', e);
    res.status(500).json({ message: 'Error fetching malfunction data.', error: e.message });
  }
};
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: api\vehicle\vehicles\[vehicleId]\repair.js
--- CONTENT START ---
// api/vehicle/vehicles/[vehicleId]/repair.js
const { db } = require('../../../_lib/firebaseAdmin');
const { verifyAuth } = require('../../../_lib/verifyAuth');

module.exports = async (req, res) => {
  if (req.method !== 'PATCH') return res.status(405).json({ message: 'Method not allowed' });

  const { vehicleId } = req.query;
  const user = await verifyAuth(req, res);
  if (!user) return;

  try {
    const ref = db.collection('vehicles').doc(vehicleId);
    const snap = await ref.get();
    if (!snap.exists) return res.status(404).json({ message: 'Vehicle not found' });

    const data = snap.data();
    if (data.status !== 'repair') return res.status(400).json({ message: 'Cannot change status, vehicle is not in repair.' });

    await ref.update({ status: 'available' });

    // Remove malfunctions
    const m = await db.collection('malfunctions').where('vehicleId', '==', vehicleId).get();
    if (!m.empty) {
      const batch = db.batch();
      m.forEach(doc => batch.delete(doc.ref));
      await batch.commit();
    }

    res.status(200).json({ message: `Vehicle ${vehicleId} status updated to "available" and malfunction(s) deleted.` });
  } catch (e) {
    console.error('repair error:', e);
    res.status(500).json({ message: 'Error updating vehicle status', error: e.message });
  }
};
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: api\vehicle\vehicles\[vehicleId]\report-issue.js
--- CONTENT START ---
// api/vehicle/vehicles/[vehicleId]/report-issue.js
const { db } = require('../../../_lib/firebaseAdmin');
const { verifyAuth } = require('../../../_lib/verifyAuth');

module.exports = async (req, res) => {
  if (req.method !== 'POST') return res.status(405).json({ message: 'Method not allowed' });

  const { vehicleId } = req.query;
  const user = await verifyAuth(req, res);
  if (!user) return;

  const { description } = req.body || {};
  if (!description) return res.status(400).json({ message: 'Description is required.' });

  try {
    const vRef = db.collection('vehicles').doc(vehicleId);
    const vDoc = await vRef.get();
    if (!vDoc.exists) return res.status(404).json({ message: 'Vehicle not found.' });

    // Log malfunction
    await db.collection('malfunctions').doc().set({
      vehicleId,
      userId: user.uid,
      description,
      status: 'Pending',
      createdAt: new Date()
    });

    // set vehicle to repair
    await vRef.update({ status: 'repair' });

    // delete active reservations for this vehicle
    const rQ = await db.collection('reservation')
      .where('vehicleId', '==', vehicleId)
      .where('status', '==', 'Active')
      .get();

    if (!rQ.empty) {
      const batch = db.batch();
      rQ.forEach(doc => batch.delete(doc.ref));
      await batch.commit();
    }

    res.status(201).json({ message: `Issue reported for vehicle ${vehicleId}, status updated to "repair", and associated reservation deleted.` });
  } catch (e) {
    console.error('report-issue error:', e);
    res.status(500).json({ message: 'Error reporting vehicle issue.', error: e.message });
  }
};

--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: api\vehicle\vehicles\[vehicleId]\reserve.js
--- CONTENT START ---
// api/vehicle/vehicles/[vehicleId]/reserve.js
const { db } = require('../../../_lib/firebaseAdmin');
const { verifyAuth } = require('../../../_lib/verifyAuth');

module.exports = async (req, res) => {
  if (req.method !== 'PATCH') return res.status(405).json({ message: 'Method not allowed' });

  const { vehicleId } = req.query;
  const user = await verifyAuth(req, res);
  if (!user) return;

  const { startDate, endDate } = req.body || {};
  if (!startDate || !endDate) return res.status(400).json({ success: false, message: 'Start date and end date are required.' });

  try {
    const vRef = db.collection('vehicles').doc(vehicleId);
    const vDoc = await vRef.get();
    if (!vDoc.exists) return res.status(404).json({ success: false, message: 'Vehicle not found.' });

    const v = vDoc.data();
    if (v.status !== 'available') return res.status(400).json({ success: false, message: 'Vehicle is not available for reservation.' });

    const resRef = db.collection('reservation').doc();
    const reservationId = resRef.id;

    await resRef.set({
      reservationId,
      vehicleId,
      userId: user.uid,
      startDate,
      endDate,
      status: 'Active',
      createdAt: new Date()
    });

    await vRef.update({ status: reservationId });

    res.status(201).json({ success: true, message: 'Reservation created successfully.' });
  } catch (e) {
    console.error('reserve error:', e);
    res.status(500).json({ success: false, message: 'Error creating reservation.', error: e.message });
  }
};
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: api\vehicle\vehicles\[vehicleId]\unreserve.js
--- CONTENT START ---
// api/vehicle/vehicles/[vehicleId]/unreserve.js
const { db } = require('../../../_lib/firebaseAdmin');
const { verifyAuth } = require('../../../_lib/verifyAuth');

module.exports = async (req, res) => {
  if (req.method !== 'PATCH') return res.status(405).json({ message: 'Method not allowed' });

  const { vehicleId } = req.query;
  const user = await verifyAuth(req, res);
  if (!user) return;

  try {
    const ref = db.collection('vehicles').doc(vehicleId);
    const snap = await ref.get();
    if (!snap.exists) return res.status(404).json({ message: 'Vehicle not found' });

    const data = snap.data();
    if (data.status === 'available' || data.status === 'repair') {
      return res.status(400).json({ message: 'Cannot change status, vehicle is not reserved.' });
    }

    await ref.update({ status: 'available' });
    res.status(200).json({ message: `Vehicle ${vehicleId} status updated to "available".` });
  } catch (e) {
    console.error('unreserve error:', e);
    res.status(500).json({ message: 'Error updating vehicle status', error: e.message });
  }
};
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: api\vehicle\vehicles\[vehicleId].js
--- CONTENT START ---
// api/vehicle/vehicles/[vehicleId].js
const { db } = require('../../_lib/firebaseAdmin');
const { verifyAuth } = require('../../_lib/verifyAuth');

module.exports = async (req, res) => {
  const { vehicleId } = req.query;
  const method = req.method;

  const user = await verifyAuth(req, res);
  if (!user) return;

  try {
    if (method === 'GET') {
      const ref = db.collection('vehicles').doc(vehicleId);
      const doc = await ref.get();
      if (!doc.exists) return res.status(404).json({ message: 'Vehicle not found' });
      return res.status(200).json({ id: doc.id, ...doc.data() });
    }

    if (method === 'DELETE') {
      // Only Admin can delete
      if (user.role !== 'Admin') return res.status(403).json({ message: 'Only admins can delete vehicles.' });

      const q = await db.collection('vehicles').where('vehicleId', '==', vehicleId).get();
      if (q.empty) return res.status(404).json({ message: 'No vehicle found with the specified ID' });

      const batch = db.batch();
      q.forEach(doc => batch.delete(doc.ref));
      await batch.commit();
      return res.status(200).json({ message: `Vehicle(s) with id '${vehicleId}' successfully deleted` });
    }

    return res.status(405).json({ message: 'Method not allowed' });
  } catch (e) {
    console.error('vehicle [id] error:', e);
    res.status(500).json({ message: 'Error handling vehicle', error: e.message });
  }
};
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: api\vehicle\vehicles.js
--- CONTENT START ---
// api/vehicle/vehicles.js
const { db } = require('../_lib/firebaseAdmin');
const { verifyAuth } = require('../_lib/verifyAuth');

module.exports = async (req, res) => {
  if (req.method !== 'GET') return res.status(405).json({ message: 'Method not allowed' });

  const user = await verifyAuth(req, res);
  if (!user) return;

  try {
    const snapshot = await db.collection('vehicles').get();
    const list = snapshot.docs.map(d => d.data());
    res.status(200).json(list);
  } catch (e) {
    console.error('get vehicles error:', e);
    res.status(500).json({ message: 'Error fetching vehicles', error: e.message });
  }
};
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: api\_lib\cloudinary.js
--- CONTENT START ---
// api/_lib/cloudinary.js
const cloudinary = require('cloudinary').v2;

const { CLOUDINARY_CLOUD_NAME, CLOUDINARY_API_KEY, CLOUDINARY_API_SECRET } = process.env;

if (!CLOUDINARY_CLOUD_NAME || !CLOUDINARY_API_KEY || !CLOUDINARY_API_SECRET) {
  console.warn('Cloudinary environment variables are missing; image upload routes will fail.');
}

cloudinary.config({
  cloud_name: CLOUDINARY_CLOUD_NAME,
  api_key: CLOUDINARY_API_KEY,
  api_secret: CLOUDINARY_API_SECRET
});

module.exports = cloudinary;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: api\_lib\firebaseAdmin.js
--- CONTENT START ---
// api/_lib/firebaseAdmin.js
const admin = require('firebase-admin');

if (!admin.apps.length) {
  // All creds must be set as Vercel environment variables
  const {
    FIREBASE_PROJECT_ID,
    FIREBASE_PRIVATE_KEY_ID,
    FIREBASE_PRIVATE_KEY,
    FIREBASE_CLIENT_EMAIL,
    FIREBASE_CLIENT_ID,
    FIREBASE_AUTH_URI,
    FIREBASE_TOKEN_URI,
    FIREBASE_AUTH_PROVIDER_CERT_URL,
    FIREBASE_CLIENT_CERT_URL
  } = process.env;

  if (!FIREBASE_PROJECT_ID || !FIREBASE_PRIVATE_KEY || !FIREBASE_CLIENT_EMAIL) {
    throw new Error('Firebase Admin environment variables are missing');
  }

  admin.initializeApp({
    credential: admin.credential.cert({
      project_id: FIREBASE_PROJECT_ID,
      private_key_id: FIREBASE_PRIVATE_KEY_ID,
      private_key: FIREBASE_PRIVATE_KEY.replace(/\\n/g, '\n'),
      client_email: FIREBASE_CLIENT_EMAIL,
      client_id: FIREBASE_CLIENT_ID,
      auth_uri: FIREBASE_AUTH_URI,
      token_uri: FIREBASE_TOKEN_URI,
      auth_provider_x509_cert_url: FIREBASE_AUTH_PROVIDER_CERT_URL,
      client_x509_cert_url: FIREBASE_CLIENT_CERT_URL
    })
  });
}

const db = admin.firestore();

module.exports = { admin, db };
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: api\_lib\verifyAuth.js
--- CONTENT START ---
// api/_lib/verifyAuth.js
const { admin, db } = require('./firebaseAdmin');

async function verifyAuth(req, res) {
  try {
    const authHeader = req.headers.authorization || '';
    const token = authHeader.startsWith('Bearer ') ? authHeader.slice(7) : null;
    if (!token) {
      res.status(401).json({ message: 'Authorization token missing' });
      return null;
    }
    const decoded = await admin.auth().verifyIdToken(token);
    const uid = decoded.uid;

    // Fetch Firestore role (default Driver)
    let role = 'Driver';
    const userDoc = await db.collection('users').doc(uid).get();
    if (userDoc.exists) role = userDoc.data().role || 'Driver';

    return { uid, role, decoded };
  } catch (e) {
    console.error('Auth verify error:', e);
    res.status(403).json({ message: 'Unauthorized access' });
    return null;
  }
}

module.exports = { verifyAuth };
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\package.json
--- CONTENT START ---
{
  "name": "frontend",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "firebase": "^11.0.1",
    "react": "^18.3.1",
    "react-calendar": "^5.1.0",
    "react-date-picker": "^11.0.0",
    "react-dom": "^18.3.1",
    "react-scripts": "^5.0.1",
    "web-vitals": "^2.1.4"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --watchAll=false",
    "eject": "react-scripts eject"
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  },
  "devDependencies": {
    "@babel/plugin-proposal-private-property-in-object": "^7.21.11",
    "@testing-library/jest-dom": "^6.6.3",
    "@testing-library/react": "^16.0.1",
    "@testing-library/user-event": "^14.5.2"
  }
}
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\public\index.html
--- CONTENT START ---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>React App</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\public\manifest.json
--- CONTENT START ---
{
  "short_name": "React App",
  "name": "Create React App Sample",
  "icons": [
    {
      "src": "favicon.ico",
      "sizes": "64x64 32x32 24x24 16x16",
      "type": "image/x-icon"
    },
    {
      "src": "logo192.png",
      "type": "image/png",
      "sizes": "192x192"
    },
    {
      "src": "logo512.png",
      "type": "image/png",
      "sizes": "512x512"
    }
  ],
  "start_url": ".",
  "display": "standalone",
  "theme_color": "#000000",
  "background_color": "#ffffff"
}
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\public\robots.txt
--- CONTENT START ---
# https://www.robotstxt.org/robotstxt.html
User-agent: *
Disallow:
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\App.css
--- CONTENT START ---
.menu-group{
  display: flex;
  flex-direction: column;
  justify-content: center; /* Centers buttons horizontally */
  align-items: center; /* Centers buttons vertically */
}

.button-group {
    display: flex;
    justify-content: center; /* Centers buttons horizontally */
    align-items: center; /* Centers buttons vertically */
    gap: 10px;
  }
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\App.js
--- CONTENT START ---
import React, { useState, useEffect } from 'react';
import './App.css';
import Register from './components/Register';
import Login from './components/Login';
import Profile from './components/Profile';
import ReserveVehicle from './components/ReserveVehicle';
import AddVehicle from './components/AddVehicle';
import UploadLicense from './components/UploadLicense';
import CurrentReservationsAdmin from './components/CurrentReservationsAdmin';
import ViewReservation from './components/ViewReservation';
import { getUserData } from './services/authService';
import { getAuth } from 'firebase/auth'; // Import Firebase Authentication

import { getReservationData } from './services/reservationService';

function App() {
  const [token, setToken] = useState(null); // Auth token
  const [role, setRole] = useState(''); // User role (Driver, Admin, Manager)
  const [licenseUploaded, setLicenseUploaded] = useState(false); // Driver's license status

  // UI Navigation States
  const [showRegister, setShowRegister] = useState(false);
  const [showProfile, setShowProfile] = useState(false);
  const [showReserve, setShowReserve] = useState(false); // Used for viewing vehicles
  const [showAddVehicle, setShowAddVehicle] = useState(false);
  const [showAllCarReservations, setShowAllCarReservations] = useState(false);

  //Reservation form
  const [uid, setUid] = useState(null);
  const [reservations, setReservations] = useState([]); 
  const [userReservation, setUserReservation] = useState(null);

  // Fetch role and license status after login
  useEffect(() => {
    // Fetch role and license status after login
    const fetchRole = async () => {
      if (token) {
        const userData = await getUserData(token);
        if (userData.success) {
          setRole(userData.data.role || 'Driver');
          setLicenseUploaded(!!userData.data.licenseImageUrl);

          const fetchAllReservations = async () => {
            try {
              const vehicleSnapshot = await getReservationData(token);
              if (vehicleSnapshot.success) {
                setReservations(vehicleSnapshot.data);
              }
            } catch (error) {
              console.log(error);
            }
          };

          fetchAllReservations();
          // Get the authenticated user's UIDd
          const auth = getAuth();
          const user = auth.currentUser;
          user ? setUid(user.uid) : setUid(null);
        }
      }
    };
    fetchRole();
  }, [token]);

  useEffect(() => {
    // Fetch user reservation only after `reservations` and `uid` have been set
    if (reservations.length > 0 && uid) {
      const userRes = reservations.find(res => res.userId === uid);
      setUserReservation(userRes);
    }
  }, [reservations, uid]);
  
  return (
    <div>
      <h1>Vehicle Management System</h1>
      {!token ? (
        <>
          {/* Register or Login UI */}
          {showRegister ? (
            <Register setToken={setToken} />
          ) : (
            <Login setToken={setToken} />
          )}
          <button
            className="goto-register-button"
            onClick={() => setShowRegister(!showRegister)}
          >
            {showRegister ? 'Switch to Login' : 'Switch to Register'}
          </button>
        </>
      ) : showAddVehicle ? (
        <AddVehicle token={token} setShowAddVehicle={setShowAddVehicle} />
      ) : showReserve ? (
        <ReserveVehicle
          token={token}
          setShowReserve={setShowReserve}
          setShowAddVehicle={setShowAddVehicle}
          setShowAllCarReservations={setShowAllCarReservations}
          canReserve={role === 'Driver'} 
          userReservationReset={setUserReservation}
        />
      ) : showProfile ? (
        <Profile token={token} setShowProfile={setShowProfile} />
      ) : showAllCarReservations ? (
        <CurrentReservationsAdmin
          token={token}
          setShowAllCarReservations={setShowAllCarReservations}
        />
      ) : (
        <div className="menu-group">
          {/* Show UploadLicense for Drivers who haven't uploaded it */}
          {role === 'Driver' && !licenseUploaded && (
            <UploadLicense token={token} />
          )}
          {/* Show the active reservation, if it exists */}
          {userReservation ? (
            <ViewReservation token={token} reservationData={userReservation} />
          ) : (<></>)}
          <div className="button-group">
            <button
              onClick={() => setShowProfile(true)}
              className="goto-register-button"
            >
              View Profile
            </button>
            <button
              onClick={() => setShowReserve(true)}
              className="goto-register-button"
            >
              {role === 'Driver' ? 'Reserve Vehicle' : 'View Vehicles'}
            </button>
            {/* Admin and Manager options */}
            {(role === 'Admin' || role === 'Manager') && (
              <button
                onClick={() => setShowAllCarReservations(true)}
                className="goto-register-button"
              >
                View All Reservations
              </button>
            )}
            <button
              onClick={() => {
                // Log out user
                setToken(null);
                setRole('');
                setShowProfile(false);
                setShowReserve(false);
                setShowAddVehicle(false);
                setShowAllCarReservations(false);
              }}
              className="goto-register-button"
            >
              Log Out
            </button>
          </div>
        </div>
      )}
    </div>
  );
}

export default App;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\components\AddVehicle.js
--- CONTENT START ---
// components/AddVehicle.js
import React, { useState } from 'react'; // Remove useEffect

import '../CSS/Profile.css';
import '../CSS/AddVehicle.css';
import { db, collection, doc, setDoc } from '../firebaseClient'; // Import Firestore

function AddVehicle({ token, setShowAddVehicle }) {
  const [vehicleName, setVehicleName] = useState('');
  const [hp, setHp] = useState('');
  const [engine, setEngine] = useState('');
  const [color, setColor] = useState('');
  const [year, setYear] = useState('');
  // Remove setImage and setError

  const handleAddVehicle = async (e) => {
    e.preventDefault();
    // Generate a unique document reference with a new ID
    const vehicleRef = doc(collection(db, 'vehicles'));
    const vehicleId = vehicleRef.id;
    const status = 'available';

    // Create a new vehicle object including the vehicleId
    const newVehicle = {
      vehicleId,           // Add the unique ID to the vehicle data
      vehicleName,
      engine,
      hp,
      color,
      year,
      status,
    };

    try {
      // Add the document with the custom ID and data
      await setDoc(vehicleRef, newVehicle);
      console.log(`Added vehicle ${newVehicle.vehicleName} with ID: ${vehicleId}`);
    } catch (error) {
      console.error("Error adding vehicle:", error);
    }

    setShowAddVehicle(false);
  };

  return (
    <div className="add-vehicle-container">
      <h2>Add vehicle</h2>
      <form onSubmit={handleAddVehicle}>
        <input
          type="vehicleName"
          placeholder="Vehicle Name"
          value={vehicleName}
          onChange={(e) => setVehicleName(e.target.value)}
          className="add-vehicle-input"
        />
        <input
          type="vehicleColor"
          placeholder="Vehicle Color"
          value={color}
          onChange={(e) => setColor(e.target.value)}
          className="add-vehicle-input"
        />
        <input
          type="year"
          placeholder="Vehicle Year"
          value={year}
          onChange={(e) => setYear(e.target.value)}
          className="add-vehicle-input"
        />
        <input
          type="engine"
          placeholder="Engine"
          value={engine}
          onChange={(e) => setEngine(e.target.value)}
          className="add-vehicle-input"
        />
        <input
          type="hp"
          placeholder="HP"
          value={hp}
          onChange={(e) => setHp(e.target.value)}
          className="add-vehicle-input"
        />
        <button type="submit" className="add-vehicle-button">Add vehicle</button>
      </form>
      <button onClick={() => setShowAddVehicle(false)} className='goto-vehicle-select-button'>Back to Vehicle selection</button>
    </div>
  );
}

export default AddVehicle;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\components\CurrentReservationsAdmin.js
--- CONTENT START ---
import React, { useState, useEffect } from 'react';
import '../CSS/Reservations.css';
import { getAdminReservations } from '../services/vehicleService';

function CurrentReservationsAdmin({ token, setShowAllCarReservations }) {
  const [reservations, setReservations] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchReservations = async () => {
      try {
        console.log('[CurrentReservationsAdmin] Fetching reservations...');
        const result = await getAdminReservations(token);

        console.log('[CurrentReservationsAdmin] Raw API Response:', result);

        if (result?.success && Array.isArray(result.data?.data)) {
          console.log('[CurrentReservationsAdmin] Reservations fetched:', result.data.data);
          setReservations(result.data.data);
        } else {
          console.error('[CurrentReservationsAdmin] Invalid data format:', result);
          throw new Error('Invalid data format in response.');
        }
      } catch (err) {
        console.error('[CurrentReservationsAdmin] Error:', err.message);
        setError('Failed to fetch reservations.');
      } finally {
        setLoading(false);
      }
    };

    fetchReservations();
  }, [token]);

  if (loading) {
    return <p>Loading reservations...</p>;
  }

  if (error) {
    return <p className="error-message">Error: {error}</p>;
  }

  if (!reservations.length) {
    return (
      <div className="reservations-container">
        <h2>Current Car Reservations</h2>
        <p>No reservations found.</p>
        <button
          onClick={() => setShowAllCarReservations(false)}
          className="goto-register-button"
        >
          Back to Dashboard
        </button>
      </div>
    );
  }

  return (
    <div className="reservations-container">
      <h2>Current Car Reservations</h2>
      <table className="reservations-table">
        <thead>
          <tr>
            <th>Reservation ID</th>
            <th>Vehicle Name</th>
            <th>Color</th>
            <th>Engine</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>User Email</th>
            <th>License Image</th>
          </tr>
        </thead>
        <tbody>
          {reservations.map((reservation) => {
            const vehicle = reservation.vehicle || {};
            const user = reservation.user || {};

            return (
              <tr key={reservation.reservationId || Math.random()}>
                <td>{reservation.reservationId || 'N/A'}</td>
                <td>{vehicle.vehicleName || 'N/A'}</td>
                <td>{vehicle.color || 'N/A'}</td>
                <td>{vehicle.engine || 'N/A'}</td>
                <td>{reservation.startDate || 'N/A'}</td>
                <td>{reservation.endDate || 'N/A'}</td>
                <td>{user.email || 'N/A'}</td>
                <td>
                  {user.licenseImageUrl ? (
                    <img
                      src={user.licenseImageUrl}
                      alt="License"
                      className="license-thumbnail"
                    />
                  ) : (
                    'N/A'
                  )}
                </td>
              </tr>
            );
          })}
        </tbody>
      </table>
      <button
        onClick={() => setShowAllCarReservations(false)}
        className="goto-register-button"
      >
        Back to Dashboard
      </button>
    </div>
  );
}

export default CurrentReservationsAdmin;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\components\Login.js
--- CONTENT START ---
// components/Login.js
import React, { useState } from 'react';
import '../CSS/LoginRegister.css';
import { auth, signInWithEmailAndPassword } from '../firebaseClient';

function Login({ setToken }) {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');

  const handleLogin = async (e) => {
    e.preventDefault();
    try {
      // Log in using Firebase Authentication
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      // Fetch the token and role
      const token = await user.getIdTokenResult();
      const role = token.claims.role || 'Driver'; // Default to Driver if no role
      
      localStorage.setItem('userRole', role); // Save role locally for role-based UI
      setToken(token.token); // Set token to be used in the app
      setError('');
    } catch (error) {
      setError(error.message); // Display error message if login fails
    }
  };

  return (
    <div className="login-container">
      <h2>Login</h2>
      <form onSubmit={handleLogin}>
        <input
          type="email"
          placeholder="Email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          className="login-input"
        />
        <input
          type="password"
          placeholder="Password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          className="login-input"
        />
        <button type="submit" className="login-button">Login</button>
      </form>
      {error && <p className="error-message">{error}</p>}
    </div>
  );
}

export default Login;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\components\MalfunctionMessage.js
--- CONTENT START ---
import React, { useState, useEffect } from "react";
import { getMalfunctionData } from "../services/vehicleService";

const MalfunctionMessage = ({ vehicleId, setShowMessage, token }) => {
  const [message, setMessage] = useState("");
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchMessage = async () => {
      setLoading(true);
      try {
        const result = await getMalfunctionData(token);
        if (result.success) {
          const malfunction = result.data.find((m) => m.vehicleId === vehicleId);
          setMessage(malfunction ? malfunction.description : "No message found.");
        } else {
          setError(result.error || "Failed to fetch malfunction message.");
        }
      } catch (error) {
        setError(error.message);
      } finally {
        setLoading(false);
      }
    };
    fetchMessage();
  }, [vehicleId, token]);

  return (
    <div className="malfunction-message">
      <h2>Malfunction Message</h2>
      {loading ? (
        <p>Loading...</p>
      ) : error ? (
        <p>Error loading message: {error}</p>
      ) : (
        <p>{message}</p>
      )}
      <button onClick={() => setShowMessage(null)} className="back-button">
        Back
      </button>
    </div>
  );
};

export default MalfunctionMessage;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\components\Profile.js
--- CONTENT START ---
// components/Profile.js
import React, { useState, useEffect, useCallback } from 'react';
import '../CSS/Profile.css';
import { getUserData, uploadLicense } from '../services/authService';

function Profile({ token, setShowProfile }) {
  const [email, setEmail] = useState('');
  const [role, setRole] = useState('');
  const [licenseImageUrl, setLicenseImageUrl] = useState(null);
  const [message, setMessage] = useState('');
  const [file, setFile] = useState(null);

  // Function to fetch and update user data
  const fetchUserData = useCallback(async () => {
    const result = await getUserData(token);
    if (result.success) {
      setEmail(result.data.email);
      setRole(result.data.role || 'Driver'); // Default role to Driver
      setLicenseImageUrl(result.data.licenseImageUrl);
    } else {
      setMessage(result.error || 'Failed to load profile data');
    }
  }, [token]);

  // Initial data fetch
  useEffect(() => {
    fetchUserData();
  }, [token, fetchUserData]);

  const handleFileChange = (e) => {
    setFile(e.target.files[0]);
  };

  const handleUpload = async (e) => {
    e.preventDefault();
    if (file) {
      const result = await uploadLicense(file, token);
      if (result.success) {
        setMessage('License uploaded successfully');
        fetchUserData(); // Fetch the updated user data immediately after upload
      } else {
        setMessage(result.error || 'Failed to upload license');
      }
    } else {
      setMessage('Please select a file to upload');
    }
  };

  return (
    <div className="profile-container">
      <h2>Profile</h2>
      <p className="profile-email">Email: {email}</p>
      <p className="profile-role">Role: {role}</p>
      {licenseImageUrl ? (
        <div>
          <h3>Your Driver’s License</h3>
          <img src={licenseImageUrl} alt="Driver's License" className="license-image" />
        </div>
      ) : (
        <p className="no-license">No driver's license uploaded yet.</p>
      )}
      <div>
        <h3>Update Driver’s License</h3>
        <form onSubmit={handleUpload}>
          <input type="file" onChange={handleFileChange} />
          <button type="submit" className="upload-button">
            Upload License
          </button>
        </form>
      </div>
      <button onClick={() => setShowProfile(false)} className="goto-register-button">
        Back to Dashboard
      </button>
      {message && <p className="profile-message">{message}</p>}
    </div>
  );
}

export default Profile;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\components\Register.js
--- CONTENT START ---
import React, { useState } from 'react';
import '../CSS/LoginRegister.css';
import { auth, db } from '../firebaseClient';
import { createUserWithEmailAndPassword } from 'firebase/auth';
import { doc, setDoc } from 'firebase/firestore';
import UploadLicense from './UploadLicense'; // Import UploadLicense component

function Register({ setToken }) {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [showUploadLicense, setShowUploadLicense] = useState(false);

  const handleRegister = async (e) => {
    e.preventDefault();
    console.log('Starting registration...');
    try {
      // Create the user
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      console.log('Registered user UID:', user.uid);

      // Get and set the authentication token
      const token = await user.getIdToken();
      setToken(token);

      // Add user data to Firestore
      await setDoc(doc(db, 'users', user.uid), {
        email: user.email,
        role: 'Driver', // Default role
        createdAt: new Date().toISOString(), // ISO format for consistency
      });

      console.log('User successfully added to Firestore.');

      // Show Upload License component
      setShowUploadLicense(true);
      setError('');
    } catch (error) {
      console.error('Error during registration:', error);
      setError(error.message);
    }
  };

  if (showUploadLicense) {
    return <UploadLicense token={auth.currentUser?.accessToken || ''} />;
  }

  return (
    <div className="login-container">
      <h2>Register</h2>
      <form onSubmit={handleRegister}>
        <input
          type="email"
          placeholder="Email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          className="login-input"
        />
        <input
          type="password"
          placeholder="Password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          className="login-input"
        />
        <button type="submit" className="login-button">
          Register
        </button>
      </form>
      {error && <p className="error-message">{error}</p>}
    </div>
  );
}

export default Register;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\components\ReportIssueForm.js
--- CONTENT START ---
// components/ReportIssueForm.js
import React, { useState } from "react";
import { reportVehicleIssue } from "../services/vehicleService"; // Import the service function
import { getAuth } from "firebase/auth"; // Import Firebase Authentication

function ReportIssueForm({ vehicleId, setShowReportIssue, fetchVehicles }) {
  const [issueDescription, setIssueDescription] = useState("");
  const [message, setMessage] = useState("");

  const handleReportIssueSubmit = async (e) => {
    e.preventDefault();
    if (!issueDescription) {
      setMessage("Please describe the issue before submitting.");
      return;
    }

    try {
      // Fetch the Firebase token
      const auth = getAuth();
      const token = await auth.currentUser.getIdToken();

      console.log("Fetched Firebase token:", token); // Debugging log

      // Call the service to report the issue
      const result = await reportVehicleIssue(vehicleId, { description: issueDescription }, token);
      if (result.success) {
        setMessage("Issue reported successfully.");
        fetchVehicles(); // Refresh the vehicle data
        setShowReportIssue(null); // Close the form
      } else {
        setMessage(result.error);
      }
    } catch (error) {
      console.error("Error reporting issue:", error);
      setMessage("Failed to report the issue. Please try again.");
    }
  };

  return (
    <div className="report-issue-form">
      <h2>Report Issue</h2>
      <form onSubmit={handleReportIssueSubmit}>
        <textarea
          value={issueDescription}
          onChange={(e) => setIssueDescription(e.target.value)}
          placeholder="Describe the issue"
        />
        <button type="submit">Submit</button>
      </form>
      {message && <p className="error-message">{message}</p>}
    </div>
  );
}

export default ReportIssueForm;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\components\ReservationControls.js
--- CONTENT START ---
import React from "react";

const ReservationControls = ({ canAddVehicle, canViewAllReservations, setShowReserve, setShowAddVehicle, setShowAllCarReservations, userReservationReset }) => {
  return (
    <div className="button-group">
      <button
        onClick={() => {
          setShowReserve(false);
          userReservationReset(null);
        }}
        className="back-button"
      >
        Back to Dashboard
      </button>
      {canAddVehicle && (
        <button onClick={() => setShowAddVehicle(true)} className="back-button">
          Add Vehicle
        </button>
      )}
      {canViewAllReservations && (
        <button
          onClick={() => setShowAllCarReservations(true)}
          className="back-button"
        >
          View All Reservations
        </button>
      )}
    </div>
  );
};

export default ReservationControls;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\components\ReserveVehicle.js
--- CONTENT START ---
import React, { useState, useEffect, useCallback } from "react";
import { getUserData } from "../services/authService";
import {
  getVehicleData,
  deleteVehicle,
  repairVehicle,
  unreserveVehicle,
} from "../services/vehicleService";
import {
  getReservationData,
  deleteReservation,
} from "../services/reservationService";
import ReserveVehicleForm from "./ReserveVehicleForm";
import ReportIssueForm from "./ReportIssueForm";
import VehicleTable from "./VehicleTable";
import VehicleDetail from "./VehicleDetail";
import MalfunctionMessage from "./MalfunctionMessage";
import ReservationControls from "./ReservationControls";
import { getAuth } from "firebase/auth";

function Reserve({
  token,
  setShowReserve,
  setShowAddVehicle,
  setShowAllCarReservations,
  userReservationReset,
}) {
  const [message, setMessage] = useState("");
  const [vehicles, setVehicles] = useState([]);
  const [reservations, setReservations] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [viewVehicle, setViewVehicle] = useState(null);
  const [reserveVehicleId, setReserveVehicleId] = useState(null);
  const [role, setRole] = useState("");
  const [uid, setUid] = useState(null);
  const [userReservation, setUserReservation] = useState(null);
  const [reportIssueVehicleId, setReportIssueVehicleId] = useState(null);
  const [showMessage, setShowMessage] = useState(null);

  const canAddVehicle = role === "Admin";
  const canRepairVehicle = role === "Admin";
  const canDeleteVehicle = role === "Admin";
  const canViewAllReservations = role === "Admin" || role === "Manager";

  // Debugging: Log variables after all dependencies are declared
  useEffect(() => {
    console.log("Reserve Debug - Vehicles:", vehicles);
    console.log("Reserve Debug - Can Repair Vehicle:", canRepairVehicle);
    console.log(
      "Reserve Debug - Handle View Message Function:",
      handleViewMessage
    );
  }, [vehicles, canRepairVehicle]);

  const fetchVehicles = useCallback(async () => {
    setLoading(true);
    try {
      const vehicleSnapshot = await getVehicleData(token);
      const reservationSnapshot = await getReservationData(token);

      if (vehicleSnapshot.success) {
        setVehicles(vehicleSnapshot.data);
      } else {
        setMessage(vehicleSnapshot.error || "Failed to load vehicle data");
      }

      if (reservationSnapshot.success) {
        setReservations(reservationSnapshot.data);
      } else {
        setMessage(reservationSnapshot.error || "Failed to load reservations.");
      }
    } catch (error) {
      console.error("Error fetching data:", error);
      setError(error.message);
    } finally {
      setLoading(false);
    }
  }, [token]);

  useEffect(() => {
    const fetchData = async () => {
      setLoading(true);
      const userData = await getUserData(token);
      if (userData.success) {
        setRole(userData.data.role || "Driver");
        const auth = getAuth();
        const user = auth.currentUser;
        user ? setUid(user.uid) : setUid(null);

        fetchVehicles();
      }
    };
    fetchData();
  }, [token, fetchVehicles]);

  useEffect(() => {
    if (reservations.length > 0 && uid) {
      const userRes = reservations.find((res) => res.userId === uid);
      setUserReservation(userRes);
    }
  }, [reservations, uid]);

  const handleReserve = (vehicleId) => {
    setReserveVehicleId(vehicleId);
  };

  const removeReserve = async (vehicle) => {
    try {
      const result = await unreserveVehicle(vehicle.vehicleId, token);
      if (result.success) {
        const reservation = reservations.find(
          (res) => res.vehicleId === vehicle.vehicleId && res.userId === uid
        );
        if (reservation) {
          const deleteResult = await deleteReservation(
            reservation.reservationId,
            token
          );
          if (deleteResult.success) {
            setUserReservation(null);
            await fetchVehicles();
          } else {
            console.error("Failed to delete reservation:", deleteResult.error);
          }
        }
      } else {
        console.error("Failed to unreserve vehicle:", result.error);
      }
    } catch (error) {
      console.error("Error removing reservation:", error);
    }
  };

  const handleView = (vehicle) => {
    setViewVehicle(vehicle);
  };

  const handleRepair = async (vehicleId) => {
    const result = await repairVehicle(vehicleId, token);
    if (result.success) {
      await fetchVehicles();
    }
  };

  const handleDelete = async (vehicleId) => {
    const result = await deleteVehicle(vehicleId, token);
    if (result.success) {
      await fetchVehicles();
    }
  };

  const handleViewMessage = (vehicleId) => {
    setShowMessage(vehicleId);
  };

  const sanitizeMessage = (msg) => {
    if (msg && msg.startsWith("Unexpected token '<'")) {
      return ""; // Return an empty string or a default message to hide it
    }
    return msg; // Otherwise, keep the original message
  };

  if (reserveVehicleId) {
    return (
      <ReserveVehicleForm
        token={token}
        reserveVehicleId={reserveVehicleId}
        setReserveVehicleId={setReserveVehicleId}
        fetchVehicles={fetchVehicles}
      />
    );
  }

  if (viewVehicle) {
    return (
      <VehicleDetail
        viewVehicle={viewVehicle}
        setViewVehicle={setViewVehicle}
        userReservationReset={userReservationReset}
      />
    );
  }

  if (reportIssueVehicleId) {
    return (
      <ReportIssueForm
        vehicleId={reportIssueVehicleId}
        setShowReportIssue={() => setReportIssueVehicleId(null)}
        fetchVehicles={fetchVehicles}
      />
    );
  }

  if (showMessage) {
    return (
      <MalfunctionMessage
        vehicleId={showMessage}
        setShowMessage={setShowMessage}
        token={token} // Pass token for API calls
      />
    );
  }

  return (
    <div className="vehicle-container">
      <h2>List of All Vehicles</h2>
      {loading ? (
        <p>Loading...</p>
      ) : error ? (
        <p>Error loading vehicles: {error}</p>
      ) : vehicles.length === 0 ? (
        <p>No vehicles found.</p>
      ) : (
        <VehicleTable
          vehicles={vehicles}
          userReservation={userReservation}
          canRepairVehicle={canRepairVehicle}
          canDeleteVehicle={canDeleteVehicle}
          handleView={handleView}
          handleReserve={handleReserve}
          removeReserve={removeReserve}
          setReportIssueVehicleId={setReportIssueVehicleId}
          handleRepair={handleRepair}
          handleDelete={handleDelete}
          handleViewMessage={handleViewMessage}
        />
      )}
      <ReservationControls
        canAddVehicle={canAddVehicle}
        canViewAllReservations={canViewAllReservations}
        setShowReserve={setShowReserve}
        setShowAddVehicle={setShowAddVehicle}
        setShowAllCarReservations={setShowAllCarReservations}
        userReservationReset={userReservationReset}
      />
      {message && <p className="profile-message">{sanitizeMessage(message)}</p>}
    </div>
  );
}

export default Reserve;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\components\ReserveVehicleForm.js
--- CONTENT START ---
// ReserveVehicleForm.js

import React, { useState } from 'react';
import Calendar from 'react-calendar';
import 'react-calendar/dist/Calendar.css';
import '../App.css';
import '../CSS/Profile.css';
import '../CSS/ReserveVehicle.css';
import '../CSS/AddVehicle.css';
import { reserveVehicle } from '../services/vehicleService';
import { db, collection, doc } from '../firebaseClient'; // Import Firestore
import { getAuth } from 'firebase/auth'; // Import Firebase Authentication

function ReserveVehicleForm({ token, reserveVehicleId, setReserveVehicleId, fetchVehicles }) {
  const [endDate, setEndDate] = useState(new Date());
  const startDate = new Date().toISOString().split('T')[0]; // Current date in 'YYYY-MM-DD' format
  const status = 'Active';
  const [message, setMessage] = useState('');

  const handleReservationSubmit = async (e) => {
    e.preventDefault();

    console.log('[ReserveVehicleForm] Start Date:', startDate);
    console.log('[ReserveVehicleForm] End Date:', endDate);

    // Get the authenticated user's UID
    const auth = getAuth();
    const user = auth.currentUser;
    const uid = user ? user.uid : null;

    if (!uid) {
      console.error('[ReserveVehicleForm] User not authenticated.');
      setMessage('Please log in to make a reservation.');
      return;
    }

    if (!endDate) {
      console.error('[ReserveVehicleForm] End date is missing.');
      setMessage('Please select an end date.');
      return;
    }

    // Generate a unique document reference with a new ID
    const reservationRef = doc(collection(db, 'reservation'));
    const reservationId = reservationRef.id;

    const newReservation = {
      reservationId,
      vehicleId: reserveVehicleId,
      userId: uid, // Use the authenticated user's UID
      startDate: startDate,
      endDate: endDate.toISOString().split('T')[0],
      status: status,
    };

    console.log('[ReserveVehicleForm] New reservation data:', newReservation);

    try {
      // Add the document with the custom ID and data
      //await setDoc(reservationRef, newReservation);
      console.log(`[ReserveVehicleForm] Added reservation with ID: ${reservationId}`);
      setReserveVehicleId(null);

      // Call backend to update vehicle status
      const result = await reserveVehicle(reserveVehicleId, {
        startDate,
        endDate: endDate.toISOString().split('T')[0],
      }, token);

      console.log('[ReserveVehicleForm] Reserve vehicle response:', result);

      if (result.success) {
        console.log(`[ReserveVehicleForm] Vehicle ${reserveVehicleId} status updated.`);
        fetchVehicles(); // Refresh the list of vehicles
      } else {
        console.error(`[ReserveVehicleForm] Failed to update vehicle status for ID: ${reserveVehicleId}`);
        setMessage('Failed to reserve vehicle. Please try again.');
      }
    } catch (error) {
      console.error('[ReserveVehicleForm] Error adding reservation:', error);
      setMessage('An error occurred while reserving the vehicle.');
    }
  };

  return (
    <div className="add-vehicle-container">
      <h2>Reserve Vehicle</h2>
      <form onSubmit={handleReservationSubmit}>
        <label>Start Date: {startDate}</label>
        <br />
        <label htmlFor="endDate">Select End Date:</label>
        <Calendar
          onChange={setEndDate}
          value={endDate}
          minDate={new Date()} // Prevent selection of past dates
        />
        <br />
        <button type="submit" className="add-vehicle-button">Reserve</button>
      </form>
      <button onClick={() => setReserveVehicleId(null)} className="goto-vehicle-select-button">
        Back to Vehicle selection
      </button>
      {message && <p className="profile-message">{message}</p>}
    </div>
  );
}

export default ReserveVehicleForm;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\components\UploadLicense.js
--- CONTENT START ---
// components/UploadLicense.js
import React, { useState } from 'react';
import PropTypes from 'prop-types';
import '../CSS/UploadLicense.css';
import { uploadLicense } from '../services/authService';

function UploadLicense({ token, setLicenseUploaded }) {
  const [file, setFile] = useState(null);
  const [message, setMessage] = useState('');

  const handleFileChange = (e) => {
    setFile(e.target.files[0]);
  };

  const handleUpload = async (e) => {
    e.preventDefault();
    if (file && token) {
      try {
        const result = await uploadLicense(file, token);
        if (result.success) {
          setMessage(result.message || 'Upload successful');
          if (setLicenseUploaded) {
            setLicenseUploaded(true); // Update state in the parent component
          }
        } else {
          setMessage(result.error || 'Upload failed');
        }
      } catch (err) {
        setMessage('An error occurred while uploading. Please try again.');
        console.error('[UploadLicense] Error:', err);
      }
    } else {
      setMessage('Please select a file and make sure you are logged in.');
    }
  };

  return (
    <div className="upload-container">
      <h2>Upload Driver's License</h2>
      <form onSubmit={handleUpload} className="upload-form">
        <input
          type="file"
          onChange={handleFileChange}
          className="file-input"
          accept="image/*"
        />
        <button type="submit" className="upload-button">
          Upload
        </button>
      </form>
      {message && <p className="upload-message">{message}</p>}
    </div>
  );
}

UploadLicense.propTypes = {
  token: PropTypes.string.isRequired, // Ensure the token is passed as a string
  setLicenseUploaded: PropTypes.func, // This is optional now to avoid breaking the component
};

export default UploadLicense;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\components\VehicleDetail.js
--- CONTENT START ---
import React from "react";

const VehicleDetail = ({ viewVehicle, setViewVehicle, userReservationReset }) => {
  return (
    <div className="vehicle-detail">
      <h2>{viewVehicle.vehicleName} Details</h2>
      <img src={viewVehicle.image} alt={viewVehicle.vehicleName} />
      <table className="vehicle-table">
        <tbody>
          <tr>
            <td>Vehicle Name:</td>
            <td>{viewVehicle.vehicleName}</td>
          </tr>
          <tr>
            <td>Engine:</td>
            <td>{viewVehicle.engine}</td>
          </tr>
          <tr>
            <td>Horsepower:</td>
            <td>{viewVehicle.hp} HP</td>
          </tr>
          <tr>
            <td>Color:</td>
            <td>{viewVehicle.color}</td>
          </tr>
          <tr>
            <td>Year:</td>
            <td>{viewVehicle.year}</td>
          </tr>
          <tr>
            <td>Status:</td>
            <td>{viewVehicle.status}</td>
          </tr>
        </tbody>
      </table>
      <button
        onClick={() => {
          setViewVehicle(null);
          userReservationReset(null);
        }}
        className="goto-register-button"
      >
        Back to vehicle list
      </button>
    </div>
  );
};

export default VehicleDetail;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\components\VehicleRow.js
--- CONTENT START ---
import React from "react";

const VehicleRow = ({ vehicle, userReservation, canRepairVehicle, canDeleteVehicle, handleView, handleReserve, removeReserve, setReportIssueVehicleId, handleRepair, handleDelete, handleViewMessage }) => {
  const status = vehicle.status;

  // Debugging
  console.log("VehicleRow Debug - Vehicle:", vehicle);
  console.log("VehicleRow Debug - Status:", status);
  console.log("VehicleRow Debug - Can Repair Vehicle:", canRepairVehicle);

  return (
    <tr className={status}>
      <td>{vehicle.vehicleName}</td>
      <td>
        {vehicle.engine} - {vehicle.hp} HP
      </td>
      <td>
        <div className="vehicle-actions">
          <button onClick={() => handleView(vehicle)} className="view-button">
            View
          </button>
          {status === "available" && !userReservation && (
            <button onClick={() => handleReserve(vehicle.vehicleId)} className="reserve-button">
              Reserve
            </button>
          )}
          {status !== "available" && userReservation?.vehicleId === vehicle.vehicleId && (
            <>
              <button onClick={() => removeReserve(vehicle)} className="reserve-button">
                Remove Reserve
              </button>
              <button onClick={() => setReportIssueVehicleId(vehicle.vehicleId)} className="reserve-button">
                Report Issue
              </button>
            </>
          )}
          {canRepairVehicle && status === "repair" && (
            <>
              <button onClick={() => handleRepair(vehicle.vehicleId)} className="reserve-button">
                Repair
              </button>
              <button onClick={() => handleViewMessage(vehicle.vehicleId)} className="reserve-button">
                View Message
              </button>
            </>
          )}
          {canDeleteVehicle && (
            <button onClick={() => handleDelete(vehicle.vehicleId)} className="reserve-button">
              Delete
            </button>
          )}
        </div>
      </td>
    </tr>
  );
};

export default VehicleRow;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\components\VehicleTable.js
--- CONTENT START ---
import React from "react";
import VehicleRow from "./VehicleRow";

const VehicleTable = ({ vehicles, userReservation, canRepairVehicle, canDeleteVehicle, handleView, handleReserve, removeReserve, setReportIssueVehicleId, handleRepair, handleDelete, handleViewMessage }) => {
  // Debugging
  console.log("VehicleTable Debug - Vehicles:", vehicles);
  console.log("VehicleTable Debug - Handle View Message Function:", handleViewMessage);

  return (
    <table className="vehicle-table">
      <thead>
        <tr>
          <th>Vehicle Name</th>
          <th>Engine</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {vehicles.map((vehicle) => (
          <VehicleRow
            key={vehicle.vehicleId}
            vehicle={vehicle}
            userReservation={userReservation}
            canRepairVehicle={canRepairVehicle}
            canDeleteVehicle={canDeleteVehicle}
            handleView={handleView}
            handleReserve={handleReserve}
            removeReserve={removeReserve}
            setReportIssueVehicleId={setReportIssueVehicleId}
            handleRepair={handleRepair}
            handleDelete={handleDelete}
            handleViewMessage={handleViewMessage}
          />
        ))}
      </tbody>
    </table>
  );
};

export default VehicleTable;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\components\ViewReservation.js
--- CONTENT START ---
// components/ViewReservation.js
import React, { useState, useEffect } from 'react';
import '../CSS/UploadLicense.css';
import '../CSS/ReserveVehicle.css';

import { getVehicleData } from '../services/vehicleService';

function ViewRes({token, reservationData}) {
    const [vehicles, setVehicles] = useState([]); 
    const [userVehicle, setUserVehicle] = useState(null); 

    useEffect(() => {
        const fetchVehicles = async () => {
            try {
            const vehicleSnapshot = await getVehicleData(token);
            if (vehicleSnapshot.success) {
                setVehicles(vehicleSnapshot.data);
            } 
            } catch (error) {
            console.log(error);
            }
        };
        fetchVehicles();
    }, [token]);

    useEffect(() => {
        // Fetch user reservation only after `reservations` and `uid` have been set
        if (vehicles.length > 0) {
          const userRes = vehicles.find(res => res.vehicleId === reservationData.vehicleId);
          setUserVehicle(userRes);
        }
      }, [vehicles, reservationData.vehicleId]); // Add reservationData.vehicleId here

    

    if(userVehicle) return(
      <div className="reservation-container">
        <h2>Your Current Reservation</h2>
            <table className="vehicle-table">
                <tbody>
                <tr>
                    <td><strong>Vehicle Name:</strong></td>
                    <td>{userVehicle.vehicleName}</td>
                </tr>
                <tr>
                    <td><strong>Start Date:</strong></td>
                    <td>{reservationData.startDate}</td>
                </tr>
                <tr>
                    <td><strong>End Date:</strong></td>
                    <td>{reservationData.endDate}</td>
                </tr>
                <tr>
                    <td><strong>Status:</strong></td>
                    <td>{reservationData.status}</td>
                </tr>
                </tbody>
            </table>
      </div>
    )

    return(<></>);
}

export default ViewRes;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\config.js
--- CONTENT START ---
// Point the frontend to Vercel serverless API under the same domain
const config = {
  getApiUrl: async () => '/api'
};

export default config;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\firebaseClient.js
--- CONTENT START ---
// src/firebaseClient.js
import { initializeApp } from 'firebase/app';
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from 'firebase/auth';
import { getFirestore, collection, addDoc, doc, setDoc} from 'firebase/firestore'; // Import Firestore
import firebaseConfig from './firebaseConfig';

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app); // Initialize Firestore

export { auth, db, signInWithEmailAndPassword, createUserWithEmailAndPassword ,collection, addDoc, doc, setDoc};
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\firebaseConfig.js
--- CONTENT START ---
const firebaseConfig = {
    apiKey: "AIzaSyCkN8jy9U1CyiZFfvfS9msRIMomQgrME9k",
    authDomain: "company-vehicle-management.firebaseapp.com",
    projectId: "company-vehicle-management",
    storageBucket: "company-vehicle-management.firebasestorage.app",
    messagingSenderId: "246118144076",
    appId: "1:246118144076:web:72c6742bf25f6573bbbce9"
  };

export default firebaseConfig;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\index.css
--- CONTENT START ---
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\index.js
--- CONTENT START ---
import React from 'react';
import { createRoot } from 'react-dom/client';
import App from './App';

const container = document.getElementById('root');
createRoot(container).render(<App />);
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\reportWebVitals.js
--- CONTENT START ---
const reportWebVitals = onPerfEntry => {
  if (onPerfEntry && onPerfEntry instanceof Function) {
    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {
      getCLS(onPerfEntry);
      getFID(onPerfEntry);
      getFCP(onPerfEntry);
      getLCP(onPerfEntry);
      getTTFB(onPerfEntry);
    });
  }
};

export default reportWebVitals;
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\services\authService.js
--- CONTENT START ---
import config from '../config';

export const uploadLicense = async (file, token) => {
  const formData = new FormData();
  formData.append('licenseImage', file);

  try {
    const API_URL = await config.getApiUrl();
    const response = await fetch(`${API_URL}/auth/upload-license`, {
      method: 'POST',
      headers: {
        Authorization: `Bearer ${token}`,
      },
      body: formData,
    });
    const data = await response.json();
    if (response.ok) {
      return { success: true, message: data.message };
    } else {
      return { success: false, error: data.message };
    }
  } catch (error) {
    return { success: false, error: error.message };
  }
};

export const getUserData = async (token) => {
  try {
    const API_URL = await config.getApiUrl();
    const response = await fetch(`${API_URL}/auth/profile`, {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });
    const data = await response.json();
    if (response.ok) {
      return { success: true, data };
    } else {
      return { success: false, error: data.message };
    }
  } catch (error) {
    return { success: false, error: error.message };
  }
};
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\services\reservationService.js
--- CONTENT START ---
// services/resrvationService.js
import config from '../config';

export const getReservationData = async (token) => {
  try {
    const API_URL = await config.getApiUrl();
    const response = await fetch(`${API_URL}/reservation/reservation`, {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });
    const data = await response.json();
    if (response.ok) {
      return { success: true, data };
    } else {
      return { success: false, error: data.message };
    }
  } catch (error) {
    return { success: false, error: error.message };
  }
};

export const getReservation = async (resId, token) => {
  try {
    const API_URL = await config.getApiUrl();
    const response = await fetch(`${API_URL}/reservation/reservation/${resId}`, {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });

    const data = await response.json();
    if (response.ok) {
      return { success: true, data };
    } else {
      return { success: false, error: data.message };
    }
  } catch (error) {
    return { success: false, error: error.message };
  }
};

export const deleteReservation = async (resId, token) => {
  try {
    const API_URL = await config.getApiUrl();
    const response = await fetch(`${API_URL}/reservation/reservation/${resId}`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${token}`,
      },
    });

    const data = await response.json();
    if (response.ok) {
      return { success: true, data };
    } else {
      return { success: false, error: data.message };
    }
  } catch (error) {
    return { success: false, error: error.message };
  }
};
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\services\vehicleService.js
--- CONTENT START ---
// services/vehicleService.js
import config from '../config';

export const getVehicleData = async (token) => {
  try {
    const API_URL = await config.getApiUrl();
    const response = await fetch(`${API_URL}/vehicle/vehicles`, {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });

    const contentType = response.headers.get('content-type');
    if (!contentType || !contentType.includes('application/json')) {
      const errorText = await response.text();
      throw new Error(`Unexpected response: ${errorText}`);
    }

    const data = await response.json();
    if (response.ok) {
      return { success: true, data };
    } else {
      return { success: false, error: data.message };
    }
  } catch (error) {
    return { success: false, error: error.message };
  }
};

export const deleteVehicle = async (vehicleId, token) => {
  try {
    const API_URL = await config.getApiUrl();
    const response = await fetch(`${API_URL}/vehicle/vehicles/${vehicleId}`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${token}`,
      },
    });

    const data = await response.json();
    if (response.ok) {
      return { success: true, data };
    } else {
      return { success: false, error: data.message };
    }
  } catch (error) {
    return { success: false, error: error.message };
  }
};

export const repairVehicle = async (vehicleId, token) => {
  try {
    const API_URL = await config.getApiUrl();
    const response = await fetch(`${API_URL}/vehicle/vehicles/${vehicleId}/repair`, {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${token}`,
      },
    });

    const data = await response.json();
    if (response.ok) {
      return { success: true, data };
    } else {
      return { success: false, error: data.message };
    }
  } catch (error) {
    return { success: false, error: error.message };
  }
};

export const unreserveVehicle = async (vehicleId, token) => {
  try {
    const API_URL = await config.getApiUrl();
    const response = await fetch(`${API_URL}/vehicle/vehicles/${vehicleId}/unreserve`, {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${token}`,
      },
    });

    const data = await response.json();
    if (response.ok) {
      return { success: true, data };
    } else {
      return { success: false, error: data.message };
    }
  } catch (error) {
    return { success: false, error: error.message };
  }
};

export const reserveVehicle = async (vehicleId, reservationData, token) => {
  try {
    const API_URL = await config.getApiUrl();
    const response = await fetch(`${API_URL}/vehicle/vehicles/${vehicleId}/reserve`, {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${token}`,
      },
      body: JSON.stringify(reservationData),
    });

    const data = await response.json();
    if (response.ok) {
      return { success: true, data };
    } else {
      return { success: false, error: data.message };
    }
  } catch (error) {
    return { success: false, error: error.message };
  }
};

export const getAdminReservations = async (token) => {
  try {
    const API_URL = await config.getApiUrl();
    const response = await fetch(`${API_URL}/vehicle/admin-reservations`, {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });
    const data = await response.json();
    if (response.ok) {
      return { success: true, data };
    } else {
      return { success: false, error: data.message };
    }
  } catch (error) {
    return { success: false, error: error.message };
  }
};

export const reportVehicleIssue = async (vehicleId, issueData, token) => {
  try {
    const API_URL = await config.getApiUrl();
    const response = await fetch(`${API_URL}/vehicle/vehicles/${vehicleId}/report-issue`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${token}`,
      },
      body: JSON.stringify(issueData),
    });

    const data = await response.json();
    if (response.ok) {
      return { success: true, data };
    } else {
      return { success: false, error: data.message };
    }
  } catch (error) {
    return { success: false, error: error.message };
  }
};

export const getMalfunctionData = async (token) => {
  try {
    const API_URL = await config.getApiUrl();
    const response = await fetch(`${API_URL}/vehicle/malfunctions`, {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });

    const data = await response.json();
    if (response.ok) {
      return { success: true, data };
    } else {
      return { success: false, error: data.message };
    }
  } catch (error) {
    return { success: false, error: error.message };
  }
};

--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: frontend\src\setupTests.js
--- CONTENT START ---
// jest-dom adds custom jest matchers for asserting on DOM nodes.
// allows you to do things like:
// expect(element).toHaveTextContent(/react/i)
// learn more: https://github.com/testing-library/jest-dom
import '@testing-library/jest-dom';
--- CONTENT END ---
=== FILE END ===

====================
OPTIONAL ROOT FILES
====================

=== FILE START ===
Path: .firebaserc
--- CONTENT START ---
{
  "projects": {
    "default": "company-vehicle-management"
  }
}
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: firebase.json
--- CONTENT START ---
{
  "firestore": {
    "rules": "firestore.rules",
    "indexes": "firestore.indexes.json"
  },
  "hosting": {
    "public": "frontend/build",
    "ignore": [
      "firebase.json",
      "**/.*",
      "**/node_modules/**"
    ],
    "rewrites": [
      {
        "source": "**",
        "destination": "/index.html"
      }
    ]
  }
}
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: firestore.rules
--- CONTENT START ---
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // This rule allows anyone with your Firestore database reference to view, edit,
    // and delete all data in your Firestore database. It is useful for getting
    // started, but it is configured to expire after 30 days because it
    // leaves your app open to attackers. At that time, all client
    // requests to your Firestore database will be denied.
    //
    // Make sure to write security rules for your app before that time, or else
    // all client requests to your Firestore database will be denied until you Update
    // your rules
    match /{document=**} {
      allow read, write: if request.time < timestamp.date(2024, 12, 2);
    }
  }
}
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: firestore.indexes.json
--- CONTENT START ---
{
  "indexes": [],
  "fieldOverrides": []
}
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: package-lock.json
--- CONTENT START ---
{
  "name": "RIRS",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {}
}
--- CONTENT END ---
=== FILE END ===

=== FILE START ===
Path: vercel.json
--- CONTENT START ---
{
  "version": 2,
  "builds": [
    { "src": "frontend/package.json", "use": "@vercel/static-build", "config": { "distDir": "build" } },
    { "src": "api/**/*.js", "use": "@vercel/node" }
  ],
  "routes": [
    { "src": "/api/(.*)", "dest": "/api/$1" },
    { "handle": "filesystem" },
    { "src": "/(.*)", "dest": "/index.html" }
  ]
}
--- CONTENT END ---
=== FILE END ===
